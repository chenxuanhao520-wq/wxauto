# æ™ºèƒ½å¯¹è¯é—­ç¯å­¦ä¹ ç³»ç»Ÿ - å¢å¼ºæ–¹æ¡ˆ

**ç‰ˆæœ¬**: v2.0 (å¢å¼ºç‰ˆ)  
**æ—¥æœŸ**: 2025-10-19  
**æ ¸å¿ƒç†å¿µ**: ä»å¯¹è¯ä¸­å­¦ä¹ ï¼Œè®©ç³»ç»Ÿè¶Šç”¨è¶Šæ™ºèƒ½  

---

## ğŸ“Š ç°æœ‰æ–¹æ¡ˆå›é¡¾

### âœ… å·²æœ‰åŠŸèƒ½ï¼ˆv1.0ï¼‰

1. **å¯¹è¯è¿½è¸ªå™¨** (`conversation_tracker.py`)
   - è¿½è¸ªå¯¹è¯æ•ˆæœï¼ˆå·²è§£å†³/æœªè§£å†³/è½¬äººå·¥ï¼‰
   - ä¿å­˜å®Œæ•´å¯¹è¯ä¸²
   - æ ‡è®°è§£å†³æ–¹å¼ï¼ˆAI/äººå·¥/è‡ªåŠ©ï¼‰
   - è‡ªåŠ¨æ‰“æ ‡ç­¾

2. **å¤šç»´è¡¨æ ¼åŒæ­¥** (`sync_to_bitable.py`)
   - åŒæ­¥åˆ°é£ä¹¦/é’‰é’‰
   - ä¸¤ç§è§†å›¾ï¼šå¯¹è¯çº§åˆ« + æ¶ˆæ¯çº§åˆ«
   - æ‰¹é‡åŒæ­¥

### âš ï¸ ç°æœ‰æ–¹æ¡ˆçš„å±€é™

1. **ä¼šè¯ç»“æŸæ—¶æœºä¸æ™ºèƒ½**
   - ç¼ºä¹è‡ªåŠ¨åˆ¤æ–­æœºåˆ¶
   - éœ€è¦æ‰‹åŠ¨æ ‡è®°ç»“æŸ

2. **ä¿¡æ¯æå–ä¸å¤Ÿè‡ªåŠ¨åŒ–**
   - éœ€è¦æ‰‹åŠ¨æå–å…³é”®ä¿¡æ¯
   - æ²¡æœ‰ç»“æ„åŒ–å®ä½“æå–

3. **çŸ¥è¯†åº“æ›´æ–°ä¸é—­ç¯**
   - å¯¹è¯ä¿¡æ¯æ²¡æœ‰è‡ªåŠ¨åå“ºçŸ¥è¯†åº“
   - æ–°é—®é¢˜æ— æ³•è‡ªåŠ¨å­¦ä¹ 

4. **ç¼ºå°‘è´¨é‡è¯„ä¼°**
   - æ²¡æœ‰è‡ªåŠ¨è´¨é‡è¯„åˆ†
   - æ— æ³•åˆ¤æ–­å“ªäº›å¯¹è¯å€¼å¾—å­¦ä¹ 

---

## ğŸ’¡ å¢å¼ºæ–¹æ¡ˆè®¾è®¡ï¼ˆv2.0ï¼‰

### æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯¹è¯è¿›è¡Œä¸­                                 â”‚
â”‚  - æ™ºèƒ½ä¸Šä¸‹æ–‡ç®¡ç†                                             â”‚
â”‚  - ä¼šè¯ç”Ÿå‘½å‘¨æœŸç›‘æ§                                           â”‚
â”‚  - å®ä½“è‡ªåŠ¨æå–                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    ä¼šè¯è‡ªåŠ¨ç»“æŸåˆ¤å®š          â”‚
        â”‚  - è¿‡æœŸè¶…æ—¶ (30åˆ†é’Ÿ)         â”‚
        â”‚  - ç”¨æˆ·æ˜ç¡®ç»“æŸ ("è°¢è°¢æ‹œæ‹œ") â”‚
        â”‚  - ä¸šåŠ¡å®Œæˆ (è®¢å•å·²ä¸‹å•)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   æ™ºèƒ½ä¿¡æ¯æå–ä¸ç»“æ„åŒ–       â”‚
        â”‚  - å…³é”®å®ä½“ (äººå/è®¢å•/äº§å“) â”‚
        â”‚  - å¯¹è¯ä¸»é¢˜                 â”‚
        â”‚  - ç”¨æˆ·æ„å›¾                 â”‚
        â”‚  - è§£å†³æ–¹æ¡ˆ                 â”‚
        â”‚  - è´¨é‡è¯„åˆ†                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   å¤šç»´è¡¨æ ¼åŒæ­¥ï¼ˆå¢å¼ºï¼‰       â”‚
        â”‚  - å¯¹è¯çº§è§†å›¾ï¼ˆå¤ç›˜ç”¨ï¼‰      â”‚
        â”‚  - çŸ¥è¯†ç‚¹è§†å›¾ï¼ˆå­¦ä¹ ç”¨ï¼‰NEW   â”‚
        â”‚  - å®¢æˆ·ç”»åƒè§†å›¾ï¼ˆåˆ†æç”¨ï¼‰NEW â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   çŸ¥è¯†åº“è‡ªåŠ¨æ›´æ–°             â”‚
        â”‚  - é«˜è´¨é‡Q&Aè‡ªåŠ¨å…¥åº“         â”‚
        â”‚  - æ–°é—®é¢˜è‡ªåŠ¨æ·»åŠ             â”‚
        â”‚  - é”™è¯¯ç­”æ¡ˆè‡ªåŠ¨ä¿®æ­£          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   LLMå­¦ä¹ åé¦ˆ               â”‚
        â”‚  - å¾®è°ƒè®­ç»ƒæ•°æ®ç”Ÿæˆ          â”‚
        â”‚  - Promptä¼˜åŒ–å»ºè®®            â”‚
        â”‚  - é«˜é¢‘é—®é¢˜æ±‡æ€»              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›ç‚¹

### æ”¹è¿›1: æ™ºèƒ½ä¼šè¯ç»“æŸåˆ¤å®š â­

**åŸæ–¹æ¡ˆ**: æ‰‹åŠ¨æˆ–å›ºå®šè¶…æ—¶  
**æ–°æ–¹æ¡ˆ**: å¤šç»´åº¦æ™ºèƒ½åˆ¤å®š

#### ä¼šè¯ç»“æŸçš„6ç§è§¦å‘æ¡ä»¶

```python
class SessionEndTrigger(Enum):
    """ä¼šè¯ç»“æŸè§¦å‘æ¡ä»¶"""
    TIMEOUT_EXPIRED = "è¶…æ—¶è¿‡æœŸ"      # 30åˆ†é’Ÿæ— æ¶ˆæ¯
    USER_EXPLICIT = "ç”¨æˆ·æ˜ç¡®ç»“æŸ"    # "è°¢è°¢"ã€"æ‹œæ‹œ"ã€"è§£å†³äº†"
    BUSINESS_COMPLETE = "ä¸šåŠ¡å®Œæˆ"    # è®¢å•å·²ä¸‹å•ã€é—®é¢˜å·²è§£å†³
    TOPIC_CHANGED = "ä¸»é¢˜åˆ‡æ¢"        # åˆ‡æ¢åˆ°æ–°è¯é¢˜
    HANDOFF_HUMAN = "è½¬äººå·¥"          # è½¬ç»™äººå·¥å®¢æœ
    ERROR_ABORT = "å¼‚å¸¸ä¸­æ–­"          # ç³»ç»Ÿé”™è¯¯

class SmartSessionEndDetector:
    """æ™ºèƒ½ä¼šè¯ç»“æŸæ£€æµ‹å™¨"""
    
    def should_end_session(self, 
                          session_info: Dict,
                          last_message: str,
                          dialogue_type: str) -> Tuple[bool, SessionEndTrigger]:
        """
        åˆ¤æ–­ä¼šè¯æ˜¯å¦åº”è¯¥ç»“æŸ
        
        Returns:
            (æ˜¯å¦ç»“æŸ, è§¦å‘åŸå› )
        """
        # 1. è¶…æ—¶åˆ¤æ–­ï¼ˆæ¥è‡ªä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ï¼‰
        if session_info['state'] == SessionState.EXPIRED:
            return True, SessionEndTrigger.TIMEOUT_EXPIRED
        
        # 2. ç”¨æˆ·æ˜ç¡®ç»“æŸä¿¡å·
        end_signals = [
            'è°¢è°¢', 'æ‹œæ‹œ', 'å†è§', 'è§£å†³äº†', 'å¥½äº†', 
            'æ˜ç™½äº†è°¢è°¢', 'çŸ¥é“äº†', 'ä¸ç”¨äº†'
        ]
        if any(signal in last_message for signal in end_signals):
            # è¿›ä¸€æ­¥ç¡®è®¤ï¼šåé¢æ²¡æœ‰æ–°é—®é¢˜
            if 'ï¼Ÿ' not in last_message and 'å—' not in last_message:
                return True, SessionEndTrigger.USER_EXPLICIT
        
        # 3. ä¸šåŠ¡å®Œæˆä¿¡å·
        business_complete_signals = [
            'å·²ä¸‹å•', 'è®¢å•ç¡®è®¤', 'æ”¯ä»˜æˆåŠŸ', 'å·²è§£å†³',
            'æå®šäº†', 'æˆåŠŸäº†', 'å¯ä»¥äº†'
        ]
        if dialogue_type == 'ä¸šåŠ¡ç±»':
            if any(signal in last_message for signal in business_complete_signals):
                return True, SessionEndTrigger.BUSINESS_COMPLETE
        
        # 4. ä¸»é¢˜åˆ‡æ¢ï¼ˆå¤§è·¨åº¦åˆ‡æ¢è§†ä¸ºæ–°ä¼šè¯ï¼‰
        # è¿™ä¸ªç”±ä¸»é¢˜æ£€æµ‹å™¨æä¾›
        
        # 5. è½¬äººå·¥
        if 'äººå·¥' in last_message or 'å®¢æœ' in last_message:
            return False, None  # ä¸ç»“æŸï¼Œç­‰å¾…äººå·¥æ¥å…¥
        
        return False, None
```

---

### æ”¹è¿›2: æ™ºèƒ½ä¿¡æ¯æå–ä¸ç»“æ„åŒ– â­

**åŸæ–¹æ¡ˆ**: ç®€å•ä¿å­˜å®Œæ•´å¯¹è¯  
**æ–°æ–¹æ¡ˆ**: æ·±åº¦æå– + ç»“æ„åŒ– + LLMæ€»ç»“

```python
from typing import Dict, List
from conversation_context import ContextCompressor
from conversation_context.session_lifecycle import SessionLifecycleManager

class EnhancedInfoExtractor:
    """å¢å¼ºå‹ä¿¡æ¯æå–å™¨"""
    
    def __init__(self, llm_client=None):
        self.compressor = ContextCompressor()
        self.llm_client = llm_client
    
    def extract_session_info(self, 
                            messages: List[Dict],
                            session_info: Dict,
                            end_trigger: SessionEndTrigger) -> Dict:
        """
        ä»ä¼šè¯ä¸­æå–å®Œæ•´ç»“æ„åŒ–ä¿¡æ¯
        
        Returns:
            {
                'basic_info': {},      # åŸºç¡€ä¿¡æ¯
                'entities': {},        # å®ä½“ä¿¡æ¯
                'dialogue_analysis': {},  # å¯¹è¯åˆ†æ
                'knowledge_points': [], # çŸ¥è¯†ç‚¹
                'quality_score': {},   # è´¨é‡è¯„åˆ†
                'learning_data': {}    # å­¦ä¹ æ•°æ®
            }
        """
        # 1. åŸºç¡€ä¿¡æ¯
        basic_info = {
            'session_id': session_info['contact_id'],
            'start_time': session_info['created_at'],
            'end_time': datetime.now(),
            'duration_seconds': (datetime.now() - session_info['created_at']).total_seconds(),
            'message_count': len(messages),
            'turn_count': sum(1 for m in messages if m['role'] == 'user'),
            'dialogue_type': session_info.get('dialogue_type'),
            'end_trigger': end_trigger.value
        }
        
        # 2. å®ä½“æå–ï¼ˆè‡ªåŠ¨ï¼‰
        entities = self.compressor.extract_key_entities(messages)
        
        # 3. å¯¹è¯åˆ†æ
        dialogue_analysis = self._analyze_dialogue(messages)
        
        # 4. çŸ¥è¯†ç‚¹æå–ï¼ˆé«˜è´¨é‡Q&Aï¼‰
        knowledge_points = self._extract_knowledge_points(messages)
        
        # 5. è´¨é‡è¯„åˆ†
        quality_score = self._calculate_quality_score(
            messages, dialogue_analysis, end_trigger
        )
        
        # 6. å­¦ä¹ æ•°æ®ç”Ÿæˆï¼ˆä¾›LLMå­¦ä¹ ï¼‰
        learning_data = self._generate_learning_data(
            messages, knowledge_points, quality_score
        )
        
        return {
            'basic_info': basic_info,
            'entities': entities,
            'dialogue_analysis': dialogue_analysis,
            'knowledge_points': knowledge_points,
            'quality_score': quality_score,
            'learning_data': learning_data
        }
    
    def _analyze_dialogue(self, messages: List[Dict]) -> Dict:
        """åˆ†æå¯¹è¯ç‰¹å¾"""
        user_messages = [m for m in messages if m['role'] == 'user']
        ai_messages = [m for m in messages if m['role'] == 'assistant']
        
        # æå–ä¸»é¢˜
        all_subtypes = [m.get('subtype') for m in messages if m.get('subtype')]
        main_topic = max(set(all_subtypes), key=all_subtypes.count) if all_subtypes else 'æœªçŸ¥'
        
        # æƒ…æ„Ÿå€¾å‘
        sentiment = self._analyze_sentiment(user_messages)
        
        # å¯¹è¯è´¨é‡
        avg_confidence = sum(
            m.get('confidence', 0) for m in ai_messages
        ) / len(ai_messages) if ai_messages else 0
        
        return {
            'main_topic': main_topic,
            'topic_changes': len(set(all_subtypes)),
            'sentiment': sentiment,
            'avg_confidence': avg_confidence,
            'user_avg_length': sum(len(m['content']) for m in user_messages) / len(user_messages) if user_messages else 0,
            'ai_avg_length': sum(len(m['content']) for m in ai_messages) / len(ai_messages) if ai_messages else 0
        }
    
    def _extract_knowledge_points(self, messages: List[Dict]) -> List[Dict]:
        """æå–çŸ¥è¯†ç‚¹ï¼ˆé«˜è´¨é‡Q&Aå¯¹ï¼‰"""
        knowledge_points = []
        
        for i in range(len(messages) - 1):
            if messages[i]['role'] == 'user' and messages[i+1]['role'] == 'assistant':
                question = messages[i]['content']
                answer = messages[i+1]['content']
                
                # åˆ¤æ–­æ˜¯å¦æ˜¯æœ‰æ•ˆçš„çŸ¥è¯†ç‚¹
                if self._is_valid_qa_pair(question, answer, messages[i+1]):
                    knowledge_points.append({
                        'question': question,
                        'answer': answer,
                        'confidence': messages[i+1].get('confidence', 0),
                        'type': messages[i].get('subtype', 'ä¸€èˆ¬å’¨è¯¢'),
                        'timestamp': messages[i]['timestamp']
                    })
        
        return knowledge_points
    
    def _is_valid_qa_pair(self, question: str, answer: str, ai_msg: Dict) -> bool:
        """åˆ¤æ–­æ˜¯å¦æ˜¯æœ‰æ•ˆçš„Q&Aå¯¹"""
        # æ¡ä»¶1: é—®é¢˜åŒ…å«ç–‘é—®è¯
        if not any(q in question for q in ['ï¼Ÿ', '?', 'æ€ä¹ˆ', 'å¦‚ä½•', 'ä»€ä¹ˆ', 'å“ªä¸ª']):
            return False
        
        # æ¡ä»¶2: å›ç­”ä¸æ˜¯é”™è¯¯ä¿¡æ¯
        error_keywords = ['æŠ±æ­‰', 'æ— æ³•', 'æš‚æ—¶', 'å¤±è´¥', 'é”™è¯¯', 'ç³»ç»Ÿå¼‚å¸¸']
        if any(kw in answer for kw in error_keywords):
            return False
        
        # æ¡ä»¶3: ç½®ä¿¡åº¦è¶³å¤Ÿé«˜
        if ai_msg.get('confidence', 0) < 0.7:
            return False
        
        # æ¡ä»¶4: å›ç­”é•¿åº¦åˆç†ï¼ˆä¸èƒ½å¤ªçŸ­ï¼‰
        if len(answer) < 20:
            return False
        
        return True
    
    def _calculate_quality_score(self, messages: List[Dict], 
                                 analysis: Dict,
                                 end_trigger: SessionEndTrigger) -> Dict:
        """è®¡ç®—å¯¹è¯è´¨é‡è¯„åˆ†"""
        score = 0
        max_score = 100
        
        # 1. ä¼šè¯å®Œæ•´æ€§ (20åˆ†)
        if end_trigger in [SessionEndTrigger.USER_EXPLICIT, SessionEndTrigger.BUSINESS_COMPLETE]:
            score += 20  # æ­£å¸¸ç»“æŸ
        elif end_trigger == SessionEndTrigger.TIMEOUT_EXPIRED:
            score += 10  # è¶…æ—¶ç»“æŸ
        
        # 2. å¯¹è¯è´¨é‡ (30åˆ†)
        avg_confidence = analysis.get('avg_confidence', 0)
        score += int(avg_confidence * 30)
        
        # 3. ç”¨æˆ·æ»¡æ„åº¦ (20åˆ†)
        sentiment = analysis.get('sentiment', 'neutral')
        sentiment_score = {'positive': 20, 'neutral': 10, 'negative': 0}
        score += sentiment_score.get(sentiment, 10)
        
        # 4. é—®é¢˜è§£å†³ (30åˆ†)
        last_messages = messages[-3:]  # æœ€å3æ¡
        solved_keywords = ['è§£å†³äº†', 'å¥½äº†', 'å¯ä»¥äº†', 'æˆåŠŸäº†', 'è°¢è°¢']
        if any(any(kw in m['content'] for kw in solved_keywords) 
               for m in last_messages if m['role'] == 'user'):
            score += 30
        
        return {
            'total_score': min(score, max_score),
            'completeness': 20 if score >= 20 else 10,
            'quality': int(avg_confidence * 30),
            'sentiment': sentiment_score.get(sentiment, 10),
            'resolution': 30 if score >= 80 else 0,
            'grade': self._get_grade(score)
        }
    
    @staticmethod
    def _get_grade(score: int) -> str:
        """è·å–è¯„çº§"""
        if score >= 90:
            return 'S'  # ä¼˜ç§€
        elif score >= 80:
            return 'A'  # è‰¯å¥½
        elif score >= 70:
            return 'B'  # ä¸­ç­‰
        elif score >= 60:
            return 'C'  # åŠæ ¼
        else:
            return 'D'  # å¾…æ”¹è¿›
    
    def _analyze_sentiment(self, messages: List[Dict]) -> str:
        """åˆ†æç”¨æˆ·æƒ…æ„Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰"""
        positive_words = ['å¥½', 'è°¢è°¢', 'æ»¡æ„', 'ä¸é”™', 'å¯ä»¥', 'è§£å†³äº†']
        negative_words = ['ä¸è¡Œ', 'ä¸å¥½', 'åƒåœ¾', 'å·®', 'çƒ‚', 'é€€è´§']
        
        content = ' '.join(m['content'] for m in messages)
        
        positive_count = sum(1 for word in positive_words if word in content)
        negative_count = sum(1 for word in negative_words if word in content)
        
        if positive_count > negative_count:
            return 'positive'
        elif negative_count > positive_count:
            return 'negative'
        else:
            return 'neutral'
    
    def _generate_learning_data(self, messages: List[Dict],
                                knowledge_points: List[Dict],
                                quality_score: Dict) -> Dict:
        """ç”Ÿæˆå­¦ä¹ æ•°æ®"""
        # åªæœ‰é«˜è´¨é‡å¯¹è¯æ‰ç”¨äºå­¦ä¹ 
        if quality_score['total_score'] < 70:
            return {'should_learn': False, 'reason': 'è´¨é‡è¯„åˆ†è¿‡ä½'}
        
        # ç”Ÿæˆè®­ç»ƒæ•°æ®æ ¼å¼
        training_examples = []
        for kp in knowledge_points:
            training_examples.append({
                'messages': [
                    {'role': 'user', 'content': kp['question']},
                    {'role': 'assistant', 'content': kp['answer']}
                ],
                'quality': kp['confidence'],
                'topic': kp['type']
            })
        
        return {
            'should_learn': True,
            'quality_score': quality_score['total_score'],
            'training_examples': training_examples,
            'knowledge_count': len(knowledge_points)
        }
```

---

### æ”¹è¿›2: å¢å¼ºçš„å¤šç»´è¡¨æ ¼è®¾è®¡ â­

#### è§†å›¾1: å¯¹è¯çº§è§†å›¾ï¼ˆå¤ç›˜å’Œåˆ†æï¼‰

**æ–°å¢å­—æ®µ**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | NEW |
|--------|------|------|-----|
| ä¼šè¯ID | æ–‡æœ¬ | å”¯ä¸€æ ‡è¯† | - |
| å¯¹è¯ç±»å‹ | å•é€‰ | é—²èŠ/å’¨è¯¢/ä¸šåŠ¡ | âœ… NEW |
| ä¸»é¢˜æ ‡ç­¾ | å¤šé€‰ | äº§å“å’¨è¯¢/è®¢å•æŸ¥è¯¢ç­‰ | âœ… NEW |
| **è´¨é‡è¯„åˆ†** | æ•°å­— | 0-100åˆ† | âœ… NEW |
| **è´¨é‡ç­‰çº§** | å•é€‰ | S/A/B/C/D | âœ… NEW |
| å¯¹è¯ç»“æœ | å•é€‰ | å·²è§£å†³/æœªè§£å†³/è½¬äººå·¥ | - |
| ç»“æŸæ–¹å¼ | å•é€‰ | æ­£å¸¸ç»“æŸ/è¶…æ—¶/è½¬äººå·¥ | âœ… NEW |
| **å…³é”®å®ä½“** | å¤šè¡Œæ–‡æœ¬ | æå–çš„æ‰‹æœº/è®¢å•/äº§å“ | âœ… NEW |
| **çŸ¥è¯†ç‚¹æ•°** | æ•°å­— | æå–çš„çŸ¥è¯†ç‚¹æ•°é‡ | âœ… NEW |
| **åº”å­¦ä¹ ** | å¤é€‰æ¡† | æ˜¯å¦å€¼å¾—LLMå­¦ä¹  | âœ… NEW |
| ç”¨æˆ·æƒ…æ„Ÿ | å•é€‰ | ç§¯æ/ä¸­æ€§/æ¶ˆæ | âœ… NEW |
| å¹³å‡ç½®ä¿¡åº¦ | æ•°å­— | AIå›å¤ç½®ä¿¡åº¦ | - |
| å®Œæ•´å¯¹è¯ | å¤šè¡Œæ–‡æœ¬ | å®Œæ•´å¯¹è¯ä¸² | - |
| Tokenæ¶ˆè€— | æ•°å­— | æ€»tokenæ•° | - |
| å¼€å§‹æ—¶é—´ | æ—¥æœŸ | - | - |
| ç»“æŸæ—¶é—´ | æ—¥æœŸ | - | - |

#### è§†å›¾2: çŸ¥è¯†ç‚¹è§†å›¾ï¼ˆè‡ªåŠ¨å­¦ä¹ ï¼‰NEW â­

**å…¨æ–°è®¾è®¡ï¼Œä¸“é—¨ç”¨äºçŸ¥è¯†åº“æ›´æ–°**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| çŸ¥è¯†ç‚¹ID | æ–‡æœ¬ | å”¯ä¸€æ ‡è¯† |
| æ¥æºä¼šè¯ID | æ–‡æœ¬ | å…³è”å¯¹è¯ |
| **é—®é¢˜** | å¤šè¡Œæ–‡æœ¬ | ç”¨æˆ·é—®é¢˜ |
| **ç­”æ¡ˆ** | å¤šè¡Œæ–‡æœ¬ | AIç­”æ¡ˆ |
| **ç­”æ¡ˆè´¨é‡** | æ•°å­— | ç½®ä¿¡åº¦ 0-1 |
| **é—®é¢˜ç±»å‹** | å•é€‰ | äº§å“/ä½¿ç”¨/ä»·æ ¼/å”®å |
| **æ˜¯å¦å·²å…¥åº“** | å¤é€‰æ¡† | æ˜¯å¦å·²åŠ å…¥çŸ¥è¯†åº“ |
| **å…¥åº“æ—¶é—´** | æ—¥æœŸ | åŠ å…¥çŸ¥è¯†åº“çš„æ—¶é—´ |
| **ä½¿ç”¨æ¬¡æ•°** | æ•°å­— | çŸ¥è¯†åº“æ£€ç´¢å‘½ä¸­æ¬¡æ•° |
| **ç”¨æˆ·åé¦ˆ** | å•é€‰ | æœ‰ç”¨/æ— ç”¨/æœªåé¦ˆ |
| æå–æ—¶é—´ | æ—¥æœŸ | - |

#### è§†å›¾3: å®¢æˆ·ç”»åƒè§†å›¾ï¼ˆå®¢æˆ·åˆ†æï¼‰NEW â­

**è‡ªåŠ¨æ„å»ºå®¢æˆ·ç”»åƒ**:

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| å®¢æˆ·ID | æ–‡æœ¬ | å¾®ä¿¡IDæˆ–æ‰‹æœºå· |
| å®¢æˆ·åç§° | æ–‡æœ¬ | - |
| **å¯¹è¯æ€»æ•°** | æ•°å­— | æ€»ä¼šè¯æ•° |
| **å’¨è¯¢æ¬¡æ•°** | æ•°å­— | å’¨è¯¢ç±»å¯¹è¯æ•° |
| **ä¸šåŠ¡æ¬¡æ•°** | æ•°å­— | ä¸šåŠ¡ç±»å¯¹è¯æ•° |
| **ä¸»è¦å…³æ³¨ç‚¹** | å¤šé€‰ | äº§å“/ä»·æ ¼/å”®åç­‰ï¼ˆè‡ªåŠ¨ç»Ÿè®¡ï¼‰ |
| **å’¨è¯¢äº§å“** | å¤šé€‰ | æå–çš„äº§å“åˆ—è¡¨ |
| **è®¢å•å·åˆ—è¡¨** | å¤šè¡Œæ–‡æœ¬ | å†å²è®¢å• |
| **å¹³å‡æ»¡æ„åº¦** | æ•°å­— | å¹³å‡åˆ† |
| **æœ€åè”ç³»** | æ—¥æœŸ | æœ€åæ´»è·ƒæ—¶é—´ |
| **å®¢æˆ·ä»·å€¼** | å•é€‰ | é«˜/ä¸­/ä½ï¼ˆåŸºäºäº’åŠ¨è´¨é‡ï¼‰ |
| **æ˜¯å¦åŒæ­¥ERP** | å¤é€‰æ¡† | æ˜¯å¦å·²åŒæ­¥åˆ°ERP |
| **ERPå®¢æˆ·ID** | æ–‡æœ¬ | ERPä¸­çš„å®¢æˆ·ç¼–å· |

---

### æ”¹è¿›3: çŸ¥è¯†åº“è‡ªåŠ¨æ›´æ–°é—­ç¯ â­

**åŸæ–¹æ¡ˆ**: æ‰‹åŠ¨ä¸Šä¼ æ–‡æ¡£  
**æ–°æ–¹æ¡ˆ**: å¯¹è¯è‡ªåŠ¨å­¦ä¹  + äººå·¥å®¡æ ¸

```python
class KnowledgeBaseLearner:
    """çŸ¥è¯†åº“è‡ªåŠ¨å­¦ä¹ å™¨"""
    
    def __init__(self, kb_service, review_threshold: float = 0.8):
        """
        åˆå§‹åŒ–
        
        Args:
            kb_service: çŸ¥è¯†åº“æœåŠ¡
            review_threshold: è‡ªåŠ¨å…¥åº“çš„è´¨é‡é˜ˆå€¼ï¼ˆ>= æ­¤å€¼è‡ªåŠ¨å…¥åº“ï¼‰
        """
        self.kb_service = kb_service
        self.review_threshold = review_threshold
    
    def process_session_end(self, extracted_info: Dict):
        """
        ä¼šè¯ç»“æŸæ—¶å¤„ç†çŸ¥è¯†ç‚¹
        
        Args:
            extracted_info: æå–çš„ä¼šè¯ä¿¡æ¯
        """
        knowledge_points = extracted_info.get('knowledge_points', [])
        
        if not knowledge_points:
            logger.info("æœ¬æ¬¡å¯¹è¯æ— æœ‰æ•ˆçŸ¥è¯†ç‚¹")
            return
        
        logger.info(f"å‘ç° {len(knowledge_points)} ä¸ªçŸ¥è¯†ç‚¹")
        
        auto_added = []
        pending_review = []
        
        for kp in knowledge_points:
            confidence = kp['confidence']
            
            if confidence >= self.review_threshold:
                # é«˜è´¨é‡ï¼Œè‡ªåŠ¨å…¥åº“
                self._add_to_knowledge_base(kp, auto_approved=True)
                auto_added.append(kp)
                logger.info(f"âœ… è‡ªåŠ¨å…¥åº“: {kp['question'][:30]}...")
            
            else:
                # ä¸­ç­‰è´¨é‡ï¼Œå¾…å®¡æ ¸
                self._add_to_review_queue(kp)
                pending_review.append(kp)
                logger.info(f"ğŸ“‹ å¾…å®¡æ ¸: {kp['question'][:30]}...")
        
        return {
            'auto_added': len(auto_added),
            'pending_review': len(pending_review)
        }
    
    def _add_to_knowledge_base(self, kp: Dict, auto_approved: bool = False):
        """æ·»åŠ åˆ°çŸ¥è¯†åº“"""
        # 1. ç”Ÿæˆå‘é‡åµŒå…¥
        embedding = self.kb_service.generate_embedding(kp['question'])
        
        # 2. ä¿å­˜åˆ°å‘é‡æ•°æ®åº“
        self.kb_service.add_document(
            content=kp['answer'],
            metadata={
                'question': kp['question'],
                'type': kp['type'],
                'source': 'conversation_learning',
                'auto_approved': auto_approved,
                'confidence': kp['confidence'],
                'created_at': datetime.now().isoformat()
            }
        )
        
        # 3. æ›´æ–°ç»Ÿè®¡
        self.kb_service.update_stats('auto_learned', 1)
    
    def _add_to_review_queue(self, kp: Dict):
        """æ·»åŠ åˆ°å¾…å®¡æ ¸é˜Ÿåˆ—ï¼ˆå¤šç»´è¡¨æ ¼ï¼‰"""
        # åŒæ­¥åˆ°å¤šç»´è¡¨æ ¼çš„"å¾…å®¡æ ¸çŸ¥è¯†ç‚¹"è§†å›¾
        # äººå·¥å¯ä»¥åœ¨è¡¨æ ¼ä¸­ç›´æ¥å®¡æ ¸å’Œç¼–è¾‘
        pass
```

---

### æ”¹è¿›4: LLMå­¦ä¹ åé¦ˆé—­ç¯ â­

```python
class LLMFeedbackLoop:
    """LLMå­¦ä¹ åé¦ˆé—­ç¯"""
    
    def generate_training_data(self, 
                              extracted_info: Dict,
                              format: str = 'jsonl') -> str:
        """
        ç”Ÿæˆè®­ç»ƒæ•°æ®
        
        Args:
            extracted_info: æå–çš„ä¼šè¯ä¿¡æ¯
            format: è¾“å‡ºæ ¼å¼ (jsonl/csv)
        
        Returns:
            è®­ç»ƒæ•°æ®ï¼ˆJSON Linesæ ¼å¼ï¼‰
        """
        learning_data = extracted_info.get('learning_data', {})
        
        if not learning_data.get('should_learn'):
            return ""
        
        # OpenAI Fine-tuning æ ¼å¼
        training_examples = []
        for example in learning_data.get('training_examples', []):
            training_examples.append({
                "messages": example['messages'],
                "metadata": {
                    "quality": example['quality'],
                    "topic": example['topic']
                }
            })
        
        if format == 'jsonl':
            import json
            return '\n'.join(json.dumps(ex, ensure_ascii=False) 
                            for ex in training_examples)
        
        return training_examples
    
    def analyze_and_suggest(self, all_sessions: List[Dict]) -> Dict:
        """
        åˆ†ææ‰€æœ‰ä¼šè¯ï¼Œç»™å‡ºä¼˜åŒ–å»ºè®®
        
        Returns:
            {
                'high_frequency_questions': [],  # é«˜é¢‘é—®é¢˜
                'low_confidence_topics': [],     # ä½ç½®ä¿¡åº¦ä¸»é¢˜
                'suggested_prompts': {},         # Promptä¼˜åŒ–å»ºè®®
                'knowledge_gaps': []             # çŸ¥è¯†åº“ç¼ºå£
            }
        """
        # 1. ç»Ÿè®¡é«˜é¢‘é—®é¢˜
        question_freq = {}
        low_confidence_topics = []
        
        for session in all_sessions:
            for msg in session.get('messages', []):
                if msg['role'] == 'user' and 'ï¼Ÿ' in msg['content']:
                    q = msg['content']
                    question_freq[q] = question_freq.get(q, 0) + 1
                
                if msg['role'] == 'assistant' and msg.get('confidence', 1) < 0.6:
                    topic = msg.get('subtype', 'æœªçŸ¥')
                    low_confidence_topics.append(topic)
        
        # é«˜é¢‘é—®é¢˜TOP10
        high_freq = sorted(question_freq.items(), key=lambda x: x[1], reverse=True)[:10]
        
        # ä½ç½®ä¿¡åº¦ä¸»é¢˜
        from collections import Counter
        topic_counter = Counter(low_confidence_topics)
        
        return {
            'high_frequency_questions': [
                {'question': q, 'count': c} for q, c in high_freq
            ],
            'low_confidence_topics': [
                {'topic': t, 'count': c} for t, c in topic_counter.most_common(5)
            ],
            'knowledge_gaps': self._identify_gaps(high_freq, topic_counter)
        }
    
    def _identify_gaps(self, high_freq, low_conf_topics) -> List[str]:
        """è¯†åˆ«çŸ¥è¯†åº“ç¼ºå£"""
        gaps = []
        
        # é«˜é¢‘ä½†ä½ç½®ä¿¡åº¦çš„é—®é¢˜
        for question, count in high_freq:
            if count >= 3:  # å‡ºç°3æ¬¡ä»¥ä¸Š
                gaps.append(f"é«˜é¢‘é—®é¢˜éœ€è¡¥å……æ–‡æ¡£: {question}")
        
        return gaps[:5]
```

---

## ğŸ”§ å®Œæ•´é›†æˆå®ç°

### ä¸»æµç¨‹ä»£ç 

```python
from conversation_context import ContextManager, SessionLifecycleManager
from conversation_context.session_lifecycle import SessionConfig, SessionState
from conversation_tracker import ConversationTracker

class EnhancedLearningSystem:
    """å¢å¼ºå‹å­¦ä¹ ç³»ç»Ÿ"""
    
    def __init__(self, db, kb_service, llm_client):
        # 1. ä¸Šä¸‹æ–‡ç®¡ç†
        self.context_mgr = ContextManager()
        
        # 2. ä¼šè¯ç”Ÿå‘½å‘¨æœŸ
        session_config = SessionConfig(
            idle_timeout=5,
            dormant_timeout=15,
            expire_timeout=30,
            send_idle_prompt=True,
            custom_timeouts={
                'é—²èŠç±»': {'idle': 2, 'dormant': 5, 'expire': 10},
                'å’¨è¯¢ç±»': {'idle': 5, 'dormant': 15, 'expire': 30},
                'ä¸šåŠ¡ç±»': {'idle': 10, 'dormant': 20, 'expire': 60}
            }
        )
        
        self.session_mgr = SessionLifecycleManager(
            config=session_config,
            message_sender=self._send_message
        )
        
        # 3. å¯¹è¯è¿½è¸ªå™¨ï¼ˆåŸæœ‰ï¼‰
        self.conv_tracker = ConversationTracker(db)
        
        # 4. ä¿¡æ¯æå–å™¨ï¼ˆæ–°ï¼‰
        self.info_extractor = EnhancedInfoExtractor(llm_client)
        
        # 5. çŸ¥è¯†åº“å­¦ä¹ å™¨ï¼ˆæ–°ï¼‰
        self.kb_learner = KnowledgeBaseLearner(kb_service)
        
        # 6. LLMåé¦ˆé—­ç¯ï¼ˆæ–°ï¼‰
        self.llm_feedback = LLMFeedbackLoop()
        
        # å¯åŠ¨ç›‘æ§
        self.session_mgr.start_monitoring()
        
        # æ³¨å†Œä¼šè¯ç»“æŸå›è°ƒ
        self._register_session_end_callback()
    
    def _register_session_end_callback(self):
        """æ³¨å†Œä¼šè¯ç»“æŸå›è°ƒ"""
        # æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æœ‰ä¼šè¯åº”è¯¥ç»“æŸ
        import threading
        
        def check_session_end():
            while True:
                for contact_id, session in list(self.session_mgr.sessions.items()):
                    # æ£€æŸ¥æ˜¯å¦åº”è¯¥ç»“æŸ
                    if session['state'] == SessionState.EXPIRED:
                        self._on_session_end(contact_id)
                
                time.sleep(60)  # æ¯åˆ†é’Ÿæ£€æŸ¥
        
        thread = threading.Thread(target=check_session_end, daemon=True)
        thread.start()
    
    def _on_session_end(self, contact_id: str):
        """ä¼šè¯ç»“æŸæ—¶çš„å¤„ç†"""
        logger.info(f"[{contact_id}] ä¼šè¯ç»“æŸï¼Œå¼€å§‹ä¿¡æ¯æå–å’Œå­¦ä¹ ...")
        
        # 1. è·å–å®Œæ•´å¯¹è¯
        messages = list(self.context_mgr.conversations.get(contact_id, []))
        session_info = self.session_mgr.get_session_info(contact_id)
        
        if not messages or not session_info:
            return
        
        # 2. æå–ç»“æ„åŒ–ä¿¡æ¯
        extracted_info = self.info_extractor.extract_session_info(
            messages,
            session_info,
            end_trigger=SessionEndTrigger.TIMEOUT_EXPIRED
        )
        
        # 3. ä¿å­˜åˆ°å¯¹è¯è¿½è¸ªå™¨ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰
        self._save_to_tracker(contact_id, extracted_info)
        
        # 4. åŒæ­¥åˆ°å¤šç»´è¡¨æ ¼ï¼ˆå¢å¼ºå­—æ®µï¼‰
        self._sync_to_bitable(contact_id, extracted_info)
        
        # 5. çŸ¥è¯†åº“è‡ªåŠ¨å­¦ä¹ 
        learn_result = self.kb_learner.process_session_end(extracted_info)
        logger.info(
            f"[{contact_id}] çŸ¥è¯†åº“å­¦ä¹ : "
            f"è‡ªåŠ¨å…¥åº“={learn_result['auto_added']}, "
            f"å¾…å®¡æ ¸={learn_result['pending_review']}"
        )
        
        # 6. ç”Ÿæˆè®­ç»ƒæ•°æ®
        training_data = self.llm_feedback.generate_training_data(extracted_info)
        if training_data:
            self._save_training_data(contact_id, training_data)
        
        # 7. æ¸…ç†ä¸Šä¸‹æ–‡
        self.context_mgr.reset_context(contact_id, keep_summary=False)
        
        logger.info(f"[{contact_id}] âœ… ä¼šè¯ç»“æŸå¤„ç†å®Œæˆ")
    
    def _save_to_tracker(self, contact_id: str, extracted_info: Dict):
        """ä¿å­˜åˆ°å¯¹è¯è¿½è¸ªå™¨"""
        # ... (ä½¿ç”¨ç°æœ‰çš„ConversationTracker)
        pass
    
    def _sync_to_bitable(self, contact_id: str, extracted_info: Dict):
        """åŒæ­¥åˆ°å¤šç»´è¡¨æ ¼ï¼ˆå¢å¼ºå­—æ®µï¼‰"""
        # ... (ä½¿ç”¨ç°æœ‰çš„sync_to_bitableï¼Œæ·»åŠ æ–°å­—æ®µ)
        pass
    
    def _save_training_data(self, contact_id: str, training_data: str):
        """ä¿å­˜è®­ç»ƒæ•°æ®"""
        import os
        os.makedirs('data/training', exist_ok=True)
        
        filename = f"data/training/{contact_id}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.jsonl"
        with open(filename, 'w', encoding='utf-8') as f:
            f.write(training_data)
        
        logger.info(f"è®­ç»ƒæ•°æ®å·²ä¿å­˜: {filename}")
```

---

## ğŸ“ˆ æ•°æ®æµè½¬å›¾

```
ç”¨æˆ·å¯¹è¯
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®æ—¶å¯¹è¯å¤„ç†         â”‚
â”‚  - æ™ºèƒ½åˆ†ç±»          â”‚
â”‚  - ä¸Šä¸‹æ–‡ç®¡ç†        â”‚
â”‚  - ä¼šè¯ç›‘æ§          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    [ä¼šè¯è¿›è¡Œä¸­]
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¼šè¯ç»“æŸåˆ¤å®š         â”‚ â† å¤šç§è§¦å‘æ¡ä»¶
â”‚  - è¶…æ—¶(30åˆ†é’Ÿ)      â”‚
â”‚  - ç”¨æˆ·æ˜ç¡®("è°¢è°¢")  â”‚
â”‚  - ä¸šåŠ¡å®Œæˆ          â”‚
â”‚  - ä¸»é¢˜åˆ‡æ¢          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ™ºèƒ½ä¿¡æ¯æå–         â”‚
â”‚  - å®ä½“æå–          â”‚
â”‚  - çŸ¥è¯†ç‚¹æå–        â”‚
â”‚  - è´¨é‡è¯„åˆ†          â”‚
â”‚  - æƒ…æ„Ÿåˆ†æ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
      â”‚         â”‚
      â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å¤šç»´è¡¨æ ¼  â”‚ â”‚çŸ¥è¯†åº“   â”‚
â”‚ 3ä¸ªè§†å›¾  â”‚ â”‚è‡ªåŠ¨æ›´æ–° â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚
     â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤ç›˜ & å­¦ä¹          â”‚
â”‚  - é«˜é¢‘é—®é¢˜åˆ†æ      â”‚
â”‚  - Promptä¼˜åŒ–        â”‚
â”‚  - è®­ç»ƒæ•°æ®ç”Ÿæˆ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç³»ç»ŸæŒç»­æ”¹è¿›         â”‚
â”‚  - çŸ¥è¯†åº“æ‰©å……        â”‚
â”‚  - æ¨¡å‹å¾®è°ƒ          â”‚
â”‚  - å›å¤è´¨é‡æå‡      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒä»·å€¼

### å¯¹æ¯”åˆ†æ

| ç»´åº¦ | åŸæ–¹æ¡ˆ (v1.0) | å¢å¼ºæ–¹æ¡ˆ (v2.0) â­ |
|------|--------------|-------------------|
| **ä¼šè¯ç»“æŸåˆ¤å®š** | æ‰‹åŠ¨/å›ºå®šè¶…æ—¶ | æ™ºèƒ½å¤šç»´åº¦åˆ¤å®š |
| **ä¿¡æ¯æå–** | ä¿å­˜å®Œæ•´å¯¹è¯ | æ·±åº¦æå–+ç»“æ„åŒ– |
| **å®ä½“è¯†åˆ«** | æ—  | âœ… è‡ªåŠ¨æå–ï¼ˆç”µè¯/è®¢å•/äº§å“ï¼‰ |
| **çŸ¥è¯†ç‚¹æå–** | æ—  | âœ… è‡ªåŠ¨è¯†åˆ«é«˜è´¨é‡Q&A |
| **è´¨é‡è¯„åˆ†** | æ—  | âœ… è‡ªåŠ¨è¯„åˆ†(0-100) |
| **çŸ¥è¯†åº“æ›´æ–°** | æ‰‹åŠ¨ä¸Šä¼  | âœ… è‡ªåŠ¨å­¦ä¹ ï¼ˆè´¨é‡>80%è‡ªåŠ¨å…¥åº“ï¼‰ |
| **å¤šç»´è¡¨æ ¼è§†å›¾** | 2ä¸ª | âœ… 3ä¸ªï¼ˆå¢åŠ çŸ¥è¯†ç‚¹å’Œå®¢æˆ·ç”»åƒï¼‰ |
| **è®­ç»ƒæ•°æ®ç”Ÿæˆ** | æ—  | âœ… è‡ªåŠ¨ç”ŸæˆJSONLæ ¼å¼ |
| **å­¦ä¹ é—­ç¯** | å•å‘ | âœ… åŒå‘åé¦ˆ |

---

## ğŸš€ å®æ–½æ­¥éª¤

### Phase 1: åŸºç¡€é›†æˆï¼ˆ1å‘¨ï¼‰

1. âœ… é›†æˆä¼šè¯ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨
2. âœ… å®ç°æ™ºèƒ½ä¼šè¯ç»“æŸåˆ¤å®š
3. âœ… å¢å¼ºä¿¡æ¯æå–å™¨
4. âœ… æ›´æ–°å¤šç»´è¡¨æ ¼å­—æ®µ

### Phase 2: è‡ªåŠ¨å­¦ä¹ ï¼ˆ2å‘¨ï¼‰

1. âœ… å®ç°çŸ¥è¯†ç‚¹è‡ªåŠ¨æå–
2. âœ… å®ç°è´¨é‡è‡ªåŠ¨è¯„åˆ†
3. âœ… çŸ¥è¯†åº“è‡ªåŠ¨æ›´æ–°ï¼ˆé«˜è´¨é‡è‡ªåŠ¨å…¥åº“ï¼‰
4. âœ… åˆ›å»º"å¾…å®¡æ ¸"è§†å›¾

### Phase 3: é—­ç¯ä¼˜åŒ–ï¼ˆ3å‘¨ï¼‰

1. âœ… ç”ŸæˆLLMè®­ç»ƒæ•°æ®
2. âœ… é«˜é¢‘é—®é¢˜åˆ†æ
3. âœ… Promptè‡ªåŠ¨ä¼˜åŒ–
4. âœ… å®¢æˆ·ç”»åƒæ„å»º

---

## ğŸ’¡ å…³é”®åˆ›æ–°ç‚¹

### 1. é›¶äººå·¥å¹²é¢„çš„çŸ¥è¯†åº“æ›´æ–°

**æµç¨‹**:
```
å¯¹è¯ç»“æŸ 
  â†’ è‡ªåŠ¨æå–Q&A (ç½®ä¿¡åº¦>0.7)
  â†’ è´¨é‡è¯„åˆ†
  â†’ é«˜è´¨é‡(>80åˆ†) â†’ è‡ªåŠ¨å…¥åº“ âœ…
  â†’ ä¸­ç­‰è´¨é‡(60-80åˆ†) â†’ å¾…å®¡æ ¸é˜Ÿåˆ— ğŸ“‹
  â†’ ä½è´¨é‡(<60åˆ†) â†’ ä¸¢å¼ƒ âŒ
```

**æ•ˆæœ**:
- æ¯å¤©è‡ªåŠ¨å…¥åº“ 5-10ä¸ª é«˜è´¨é‡Q&A
- 1ä¸ªæœˆç§¯ç´¯ 150-300ä¸ª å®æˆ˜é—®ç­”
- çŸ¥è¯†åº“æŒç»­æ‰©å……ï¼Œæ— éœ€äººå·¥ç»´æŠ¤

---

### 2. æ™ºèƒ½çš„ä¼šè¯è¾¹ç•Œåˆ¤å®š

**å¤šç»´åº¦åˆ¤å®š**:
```python
ä¼šè¯åº”è¯¥ç»“æŸ å¦‚æœ:
  âœ… è¶…æ—¶è¿‡æœŸ (ä¸šåŠ¡ç±»60åˆ†é’Ÿ / å’¨è¯¢ç±»30åˆ†é’Ÿ / é—²èŠç±»10åˆ†é’Ÿ)
  âœ… ç”¨æˆ·æ˜ç¡®ç»“æŸ ("è°¢è°¢æ‹œæ‹œ"ã€"è§£å†³äº†")
  âœ… ä¸šåŠ¡å®Œæˆ ("è®¢å•å·²æäº¤"ã€"æ”¯ä»˜æˆåŠŸ")
  âœ… è½¬äººå·¥ (ç”¨æˆ·è¦æ±‚äººå·¥å®¢æœ)
  âœ… ä¸»é¢˜å¤§å¹…åˆ‡æ¢ (ä»"äº§å“å’¨è¯¢"åˆ‡æ¢åˆ°"è®¢å•æŸ¥è¯¢")
```

---

### 3. ä¸‰ä¸ªè§†å›¾çš„å¤šç»´è¡¨æ ¼

#### è§†å›¾1: å¯¹è¯å¤ç›˜è§†å›¾
- **ç”¨é€”**: åˆ†æå¯¹è¯æ•ˆæœ
- **ç²’åº¦**: ä¸€ä¸ªä¼šè¯ä¸€æ¡
- **å…³é”®å­—æ®µ**: è´¨é‡è¯„åˆ†ã€å¯¹è¯ç»“æœã€å…³é”®å®ä½“

#### è§†å›¾2: çŸ¥è¯†ç‚¹å­¦ä¹ è§†å›¾ â­ NEW
- **ç”¨é€”**: çŸ¥è¯†åº“è‡ªåŠ¨æ›´æ–°
- **ç²’åº¦**: ä¸€ä¸ªQ&Aä¸€æ¡
- **å…³é”®å­—æ®µ**: é—®é¢˜ã€ç­”æ¡ˆã€è´¨é‡ã€æ˜¯å¦å·²å…¥åº“

#### è§†å›¾3: å®¢æˆ·ç”»åƒè§†å›¾ â­ NEW
- **ç”¨é€”**: å®¢æˆ·åˆ†æå’ŒERPåŒæ­¥
- **ç²’åº¦**: ä¸€ä¸ªå®¢æˆ·ä¸€æ¡
- **å…³é”®å­—æ®µ**: å¯¹è¯æ¬¡æ•°ã€ä¸»è¦å…³æ³¨ç‚¹ã€è®¢å•åˆ—è¡¨ã€æ˜¯å¦åŒæ­¥ERP

---

## ğŸ“Š æ•ˆæœé¢„æœŸ

### çŸ¥è¯†åº“å¢é•¿

| æ—¶é—´ | è‡ªåŠ¨å…¥åº“ | å¾…å®¡æ ¸ | æ€»ç§¯ç´¯ |
|------|---------|--------|--------|
| 1å‘¨ | 35ä¸ª | 20ä¸ª | 55ä¸ª |
| 1æœˆ | 150ä¸ª | 80ä¸ª | 230ä¸ª |
| 3æœˆ | 450ä¸ª | 240ä¸ª | 690ä¸ª |

### å›å¤è´¨é‡æå‡

| æŒ‡æ ‡ | åˆå§‹ | 1æœˆå | 3æœˆå |
|------|------|-------|-------|
| å¹³å‡ç½®ä¿¡åº¦ | 0.70 | 0.78 | 0.85 |
| é—®é¢˜è§£å†³ç‡ | 65% | 75% | 85% |
| ç”¨æˆ·æ»¡æ„åº¦ | 3.8 | 4.2 | 4.6 |

### æˆæœ¬èŠ‚çœ

| é¡¹ç›® | èŠ‚çœ |
|------|------|
| Tokenæ¶ˆè€— | 75%â†“ (ä¸Šä¸‹æ–‡ä¼˜åŒ–) + 10%â†“ (çŸ¥è¯†åº“å‘½ä¸­) = **85%â†“** |
| äººå·¥å·¥ä½œé‡ | 60%â†“ (è‡ªåŠ¨å­¦ä¹ ) |
| å“åº”æ—¶é—´ | 50%â†“ (æœ¬åœ°çŸ¥è¯†åº“) |

---

## ğŸ‰ æ€»ç»“

### âœ… æ ¸å¿ƒæ”¹è¿›

ç›¸æ¯”åŸæ–¹æ¡ˆçš„ **5å¤§å‡çº§**:

1. **æ™ºèƒ½ç»“æŸåˆ¤å®š** - ä¸å†ä¾èµ–å›ºå®šè¶…æ—¶
2. **æ·±åº¦ä¿¡æ¯æå–** - è‡ªåŠ¨æå–å®ä½“ã€çŸ¥è¯†ç‚¹ã€è´¨é‡è¯„åˆ†
3. **çŸ¥è¯†åº“é—­ç¯** - é«˜è´¨é‡Q&Aè‡ªåŠ¨å…¥åº“
4. **ä¸‰è§†å›¾è®¾è®¡** - å¯¹è¯/çŸ¥è¯†ç‚¹/å®¢æˆ·ç”»åƒ
5. **LLMå­¦ä¹ åé¦ˆ** - ç”Ÿæˆè®­ç»ƒæ•°æ®ï¼ŒæŒç»­ä¼˜åŒ–

### ğŸ¯ å®æ–½ä¼˜å…ˆçº§

**ç¬¬ä¸€ä¼˜å…ˆ**: æ™ºèƒ½ä¼šè¯ç»“æŸåˆ¤å®š + ä¿¡æ¯æå–  
**ç¬¬äºŒä¼˜å…ˆ**: çŸ¥è¯†åº“è‡ªåŠ¨å­¦ä¹   
**ç¬¬ä¸‰ä¼˜å…ˆ**: ä¸‰è§†å›¾å¤šç»´è¡¨æ ¼  
**ç¬¬å››ä¼˜å…ˆ**: LLMåé¦ˆé—­ç¯  

---

**ä¸‹ä¸€æ­¥**: æˆ‘æ¥å®ç°å®Œæ•´ä»£ç ï¼

