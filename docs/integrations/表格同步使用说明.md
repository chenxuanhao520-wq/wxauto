# 📊 飞书/钉钉表格同步使用说明

## 🎯 快速开始

### 第一步：配置表格凭证

在 Web 管理界面（http://localhost:5000/config）配置页面中设置：

#### 飞书配置
```
飞书 App ID: cli_xxxxxxxxxxxxxxxxx
飞书 App Secret: xxxxxxxxxxxxxxxxxxxx
多维表格 Token: bascnxxxxxxxxxxxxxxx
表格 ID: tblxxxxxxxxxxxxxxxxx
```

#### 钉钉配置
```
钉钉 App Key: dingtalkxxxxxxxxxx
钉钉 App Secret: xxxxxxxxxxxxxxxxxxxx
Base ID: xxxxxxxxxxxx
表格 ID: xxxxxxxxxxxx
```

---

### 第二步：创建表格

在飞书或钉钉中创建表格，包含以下字段：

| 字段名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| 客户编号 | 文本 | ✅ | K0001格式 |
| 姓名 | 文本 | ✅ | 客户姓名 |
| 群聊名称 | 文本 | ✅ | 所属群聊 |
| 微信备注 | 文本 | - | 微信备注名 |
| 优先级 | 数字 | - | 1-5，默认3 |
| 备注 | 文本 | - | 其他信息 |

**示例数据：**

| 客户编号 | 姓名 | 群聊名称 | 微信备注 | 优先级 | 备注 |
|---------|------|---------|---------|--------|------|
| K0001 | 张三 | 技术支持群 | K0001 张三 | 3 | 新客户 |
| K0002 | 李四 | VIP客户群 | K0002 李四 | 5 | VIP客户，重点维护 |
| K0003 | 王五 | 技术支持群 | K0003 王五 | 2 | 测试客户 |

---

### 第三步：同步客户信息

访问 **客户管理页面**（http://localhost:5000/customers）：

#### 方式1：从表格导入（推荐首次使用）
1. 点击「同步」按钮
2. 选择「从表格导入」
3. 等待同步完成
4. 查看客户列表

#### 方式2：导出到表格
1. 在系统中注册客户
2. 点击「同步」→「导出到表格」
3. 在飞书/钉钉表格中查看更新

#### 方式3：双向同步
- 同时执行导入和导出
- 确保数据一致性

---

### 第四步：在微信中设置备注

关键步骤：**必须在微信中将客户备注改为对应的客户编号格式**

#### 正确示例：
- ❌ 错误：`张三`
- ❌ 错误：`张总`
- ✅ 正确：`K0001 张三`
- ✅ 正确：`K0001`

#### 如何设置：
1. 在微信中找到客户
2. 点击客户头像
3. 点击「设置备注」
4. 输入：`K0001 张三`（客户编号 + 空格 + 姓名）
5. 保存

---

## 💡 工作流程

### 完整使用流程

```
1. 在飞书/钉钉表格中添加客户信息
   ↓
2. 在Web界面点击「从表格导入」
   ↓
3. 在微信中修改客户备注为编号格式
   ↓
4. 客户在群里 @ 小助手提问
   ↓
5. 系统自动识别客户编号
   ↓
6. 根据客户优先级和群聊类型提供服务
   ↓
7. 系统自动更新统计数据到表格
```

---

## 🎯 实际案例

### 案例1：新VIP客户入群

**场景：**李总（VIP客户）被拉入"VIP客户群"

**操作步骤：**

1. **在飞书表格中添加：**
   ```
   客户编号：K0100
   姓名：李总
   群聊名称：VIP客户群
   微信备注：K0100 李总
   优先级：5
   备注：重要客户，公司高管
   ```

2. **同步到系统：**
   - 打开 http://localhost:5000/customers
   - 点击「同步」→「从表格导入」
   - 看到提示："导入完成！飞书: 1 新增"

3. **在微信中设置备注：**
   - 找到李总
   - 设置备注：`K0100 李总`

4. **客户咨询：**
   ```
   李总在VIP客户群：@小助手 设备无法启动
   ```

5. **系统响应：**
   - ✅ 识别客户编号：K0100
   - ✅ 识别客户类型：VIP
   - ✅ 优先级：5（最高）
   - ✅ 提供专业详细回复
   - ✅ 必要时立即转人工

6. **数据自动更新：**
   - 表格中"总问题数"自动 +1
   - "最后活跃"更新为当前时间
   - 记录问题解决情况

---

### 案例2：批量导入客户

**场景：**公司有50个现有客户需要导入系统

**操作步骤：**

1. **准备Excel文件：**
   ```
   客户编号 | 姓名   | 群聊名称    | 优先级
   K0001   | 张三   | 技术支持群  | 3
   K0002   | 李四   | 技术支持群  | 3
   K0003   | 王五   | VIP客户群   | 5
   ...
   ```

2. **导入到飞书表格：**
   - 打开飞书多维表格
   - 选择「导入」→「Excel」
   - 上传文件，映射字段

3. **同步到系统：**
   - Web界面 → 客户管理
   - 点击「从表格导入」
   - 等待同步完成

4. **批量设置微信备注：**
   - 逐个在微信中设置备注
   - 或使用微信批量备注工具

5. **完成：**
   - 所有客户信息已同步
   - 系统开始自动服务

---

## 📝 日常维护

### 每日工作

1. **早上：** 检查同步状态
   - 访问客户管理页面
   - 点击「同步状态」查看昨日同步情况

2. **中午：** 手动同步一次
   - 点击「双向同步」
   - 确保数据最新

3. **晚上：** 查看统计报表
   - 在飞书/钉钉表格中查看
   - 分析客户问题和解决率

### 每周工作

1. **整理客户信息**
   - 更新客户备注
   - 调整客户优先级
   - 清理无效客户

2. **分析数据**
   - 统计问题类型
   - 分析解决率趋势
   - 优化服务策略

---

## ⚠️ 常见问题

### Q1: 客户无法被识别怎么办？

**A:** 检查以下几点：
1. 微信备注是否包含客户编号（KXXXX）
2. 表格中是否存在该客户
3. 是否已执行同步
4. 客户编号格式是否正确

### Q2: 同步失败怎么办？

**A:** 按以下步骤排查：
1. 检查网络连接
2. 验证API密钥是否正确
3. 确认表格权限
4. 查看系统日志

### Q3: 数据不一致怎么办？

**A:** 解决方法：
1. 执行「双向同步」
2. 检查是否有重复编号
3. 必要时清空本地数据重新导入

### Q4: 如何修改客户优先级？

**A:** 两种方式：
1. 在表格中修改优先级字段，然后同步
2. 在Web界面客户详情中修改，然后导出

---

## 🎉 最佳实践

### 1. 编号管理

```
K0001-K1000:   VIP客户
K1001-K5000:   普通客户
K5001-K8000:   潜在客户
K8001-K9000:   合作伙伴
K9001-K9999:   测试账号
```

### 2. 优先级设置

```
5 星：VIP客户，立即响应
4 星：重要客户，优先响应
3 星：普通客户，正常响应
2 星：低频客户，常规响应
1 星：测试账号，有空响应
```

### 3. 群聊分类

```
VIP客户群：   优先级 5，自动响应，快速转人工
技术支持群：  优先级 3，自动响应，适度转人工
产品咨询群：  优先级 3，自动响应，降低转人工
测试群：      优先级 1，自动响应，不转人工
```

### 4. 备注规范

```
格式：K编号 姓名 [公司] [职位]

示例：
- K0001 张三
- K0002 李总 ABC公司
- K0003 王经理 XYZ公司 技术总监
```

---

## 📞 需要帮助？

- 📖 详细文档：`docs/表格配置指南.md`
- 💬 技术支持：技术支持群
- 🐛 问题反馈：GitHub Issues

---

**立即开始使用，让客户管理更高效！** 🚀
