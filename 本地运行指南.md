# 🚀 本地运行指南 - 微信客服中台

## ⚠️ 前置要求

您需要先安装 Python 3.10 或更高版本。

---

## 📦 第一步：安装 Python

### Windows 安装步骤

1. **下载 Python 3.11**
   - 访问: https://www.python.org/downloads/windows/
   - 下载 "Windows installer (64-bit)"
   - 推荐版本: Python 3.11.x

2. **运行安装程序**
   - 双击下载的 `.exe` 文件
   - ⚠️ **重要**: 勾选 "Add Python to PATH"
   - 点击 "Install Now"
   - 等待安装完成

3. **验证安装**
   ```cmd
   python --version
   ```
   应该显示: `Python 3.11.x`

---

## 🎯 第二步：快速启动项目

### 方法 1: 使用一键启动脚本（推荐）

打开 PowerShell 或 CMD，运行:

```cmd
# 进入项目目录
cd C:\Users\Administrator\Desktop\wxauto

# 运行快速启动
python quickstart.py
```

这个脚本会自动:
- ✅ 检查依赖
- ✅ 安装缺失的包
- ✅ 初始化数据库
- ✅ 运行测试
- ✅ 运行演示

### 方法 2: 手动安装（如果方法1失败）

```cmd
# 1. 安装核心依赖
pip install pyyaml requests openai pytest

# 2. 初始化数据库
python -c "from storage.db import Database; db=Database('data/data.db'); db.init_database(); db.close()"

# 3. 运行演示
python demo.py

# 4. 启动主程序（测试模式）
python main.py
```

---

## 🔧 第三步：配置环境（可选）

### 测试模式（无需配置）

直接运行即可，系统会使用模拟适配器:
```cmd
python main.py
```

### 真实模式（需要配置）

#### 配置大模型 API（至少选一个）

**方案A: DeepSeek（推荐，最便宜）**
```cmd
# 访问 https://platform.deepseek.com/ 获取API Key
set DEEPSEEK_API_KEY=sk-your-key-here
```

**方案B: OpenAI（质量最好）**
```cmd
# 访问 https://platform.openai.com/ 获取API Key
set OPENAI_API_KEY=sk-your-key-here
```

**方案C: 通义千问（国内稳定）**
```cmd
# 访问 https://dashscope.aliyun.com/ 获取API Key
set QWEN_API_KEY=sk-your-key-here
```

#### 配置微信适配器

```cmd
# 1. 确保 PC 微信已登录并保持前台
# 2. 关闭测试模式
set USE_FAKE_ADAPTER=false

# 3. 启动
python main.py
```

---

## 📊 第四步：验证运行

### 1. 运行测试

```cmd
pytest tests/ -v
```

应该看到: `44+ passed`

### 2. 健康检查

```cmd
python ops_tools.py health
```

应该显示:
- ✅ 数据库正常
- ✅ AI 网关可用
- ✅ 知识库已加载

### 3. 查看知识库

```cmd
# 查看知识库内容
python kb_manager.py --action list

# 测试检索
python kb_manager.py --action search --query "如何安装"
```

---

## 🎯 完整功能（可选）

### 1. 多模态支持（语音+图片）

```cmd
# 安装多模态依赖
pip install funasr paddleocr paddlepaddle
```

### 2. 向量检索（高级知识库）

```cmd
# 安装向量检索依赖
pip install chromadb FlagEmbedding
```

### 3. 多维表格集成（飞书/钉钉）

```cmd
# 配置飞书
set FEISHU_APP_ID=cli_xxxxx
set FEISHU_APP_SECRET=xxxxx
set FEISHU_BITABLE_TOKEN=bascnxxxxx
set FEISHU_TABLE_ID=tblxxxxx

# 测试连接
python sync_to_bitable.py test --platform feishu

# 同步数据
python sync_to_bitable.py sync --platform feishu --days 7
```

---

## 🐛 常见问题

### Q1: 提示 "python 不是内部命令"

**原因**: Python 未添加到 PATH 环境变量

**解决**:
1. 重新安装 Python，确保勾选 "Add Python to PATH"
2. 或手动添加到 PATH:
   - 找到 Python 安装路径（通常是 `C:\Users\Administrator\AppData\Local\Programs\Python\Python311`）
   - 添加到系统环境变量 PATH

### Q2: pip 安装依赖失败

**解决**:
```cmd
# 升级 pip
python -m pip install --upgrade pip

# 使用国内镜像
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pyyaml requests openai pytest
```

### Q3: wxauto 导入失败

**原因**: wxauto 仅支持 Windows + PC 微信

**解决**:
- 使用测试模式: `python main.py` （默认）
- 或配置真实模式但确保 PC 微信已登录

### Q4: 数据库初始化失败

**解决**:
```cmd
# 手动创建目录
mkdir data

# 重新初始化
python -c "from storage.db import Database; db=Database('data/data.db'); db.init_database(); db.close()"
```

---

## 📚 查看文档

- **完整功能指南**: `FINAL_GUIDE.md`
- **快速开始**: `START_HERE.md`
- **大模型配置**: `docs/LLM_PROVIDERS.md`
- **多模态支持**: `docs/MULTIMODAL_SUPPORT.md`
- **对话追踪**: `docs/CONVERSATION_TRACKING.md`

---

## 🎉 开始使用！

```cmd
# 最简单的方式：
python quickstart.py

# 查看帮助：
python main.py --help

# 查看知识库：
python kb_manager.py --action list

# 健康检查：
python ops_tools.py health
```

---

## 💡 推荐配置（充电桩客服场景）

```yaml
# config.yaml
llm:
  primary: deepseek:chat       # 性价比最高
  fallback: qwen:qwen-max      # 国内备用

multimodal:
  asr:
    enabled: true
    provider: funasr           # 免费，中文好
  ocr:
    enabled: true
    provider: paddleocr        # 免费，准确率高

rate_limit:
  per_group_per_minute: 15
  enable_humanize: true
```

**预期成本**: ¥100-200/月  
**AI解决率**: 85%+  
**平均响应**: 3-5秒

---

**准备好了吗？开始您的智能客服之旅！** 🚀

**最后更新**: 2025-10-17

