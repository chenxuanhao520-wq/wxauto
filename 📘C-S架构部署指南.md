# ğŸ“˜ C/Sæ¶æ„éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ¶æ„è¯´æ˜

æœ¬ç³»ç»Ÿé‡‡ç”¨**è½»å®¢æˆ·ç«¯-é‡æœåŠ¡å™¨**æ¶æ„ï¼š

```
Windowså®¢æˆ·ç«¯ (client/)      â†â†’      äº‘æœåŠ¡å™¨ (server/)
- å¾®ä¿¡UIè‡ªåŠ¨åŒ–                      - AIå¯¹è¯ç”Ÿæˆ
- æ¶ˆæ¯æ”¶å‘                           - çŸ¥è¯†åº“æ£€ç´¢
- æœ¬åœ°ç¼“å­˜                           - è§„åˆ™å¼•æ“
- å¿ƒè·³ä¸ŠæŠ¥                           - ERPåŒæ­¥
~50MBå†…å­˜                            å¯å¼¹æ€§æ‰©å±•
```

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
wxauto-1/
â”œâ”€â”€ client/                 # å®¢æˆ·ç«¯ï¼ˆWindowsï¼‰
â”‚   â”œâ”€â”€ agent/             # å¾®ä¿¡è‡ªåŠ¨åŒ–
â”‚   â”œâ”€â”€ api/               # æœåŠ¡å™¨é€šä¿¡
â”‚   â”œâ”€â”€ cache/             # æœ¬åœ°ç¼“å­˜
â”‚   â”œâ”€â”€ monitor/           # å¿ƒè·³ç›‘æ§
â”‚   â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ main_client.py     # å®¢æˆ·ç«¯ä¸»ç¨‹åº
â”‚
â”œâ”€â”€ server/                 # æœåŠ¡å™¨ï¼ˆäº‘ç«¯ï¼‰
â”‚   â”œâ”€â”€ api/               # REST API
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ main_server.py     # æœåŠ¡å™¨ä¸»ç¨‹åº
â”‚
â”œâ”€â”€ modules/                # å…±äº«æ¨¡å—
â”‚   â”œâ”€â”€ ai_gateway/        # AIç½‘å…³
â”‚   â”œâ”€â”€ rag/               # çŸ¥è¯†åº“æ£€ç´¢
â”‚   â”œâ”€â”€ storage/           # æ•°æ®åº“
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ core/                   # æ ¸å¿ƒåŠŸèƒ½
    â”œâ”€â”€ customer_manager/  # å®¢æˆ·ç®¡ç†
    â””â”€â”€ ...
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1: æœ¬åœ°å¼€å‘æµ‹è¯•

#### 1. å¯åŠ¨æœåŠ¡å™¨

```bash
# å®‰è£…æœåŠ¡å™¨ä¾èµ–
pip install -r requirements_server.txt

# å¯åŠ¨æœåŠ¡å™¨
cd server
python main_server.py

# æˆ–ä½¿ç”¨uvicorn
uvicorn server.main_server:app --reload
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:8000` å¯åŠ¨

#### 2. å¯åŠ¨å®¢æˆ·ç«¯

```bash
# å®‰è£…å®¢æˆ·ç«¯ä¾èµ–
pip install -r requirements_client.txt

# é…ç½®å®¢æˆ·ç«¯
# ç¼–è¾‘ client/config/client_config.yaml
# è®¾ç½®agent_idå’Œapi_key

# å¯åŠ¨å®¢æˆ·ç«¯
python client/main_client.py
```

---

### æ–¹å¼2: Dockeréƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

#### 1. ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡å™¨ + æ•°æ®åº“ + Redis
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f server

# åœæ­¢æœåŠ¡
docker-compose down
```

æœåŠ¡å°†åœ¨ä»¥ä¸‹ç«¯å£å¯åŠ¨ï¼š
- FastAPIæœåŠ¡å™¨: `http://localhost:8000`
- PostgreSQL: `localhost:5432`
- Redis: `localhost:6379`

#### 2. å®¢æˆ·ç«¯è¿æ¥

Windowså®¢æˆ·ç«¯ä»ç„¶ä½¿ç”¨æœ¬åœ°Pythonè¿è¡Œï¼š

```bash
python client/main_client.py
```

é…ç½®æ–‡ä»¶æŒ‡å‘DockeræœåŠ¡å™¨ï¼š
```yaml
server:
  url: "http://your-server-ip:8000"
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### å®¢æˆ·ç«¯é…ç½® (`client/config/client_config.yaml`)

```yaml
server:
  url: "http://localhost:8000"    # æœåŠ¡å™¨åœ°å€

client:
  agent_id: "agent_001"            # å®¢æˆ·ç«¯å”¯ä¸€ID
  api_key: "your-api-key-here"     # APIå¯†é’¥

wechat:
  check_interval: 1                # æ¶ˆæ¯æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰

cache:
  enabled: true                    # å¯ç”¨æœ¬åœ°ç¼“å­˜
  cleanup_days: 7                  # ç¼“å­˜ä¿ç•™å¤©æ•°

heartbeat:
  enabled: true                    # å¯ç”¨å¿ƒè·³
  interval: 30                     # å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰
```

### æœåŠ¡å™¨é…ç½®

æœåŠ¡å™¨é…ç½®é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†ï¼š

```bash
# .envæ–‡ä»¶
DATABASE_URL=postgresql://user:password@localhost:5432/wxauto
REDIS_URL=redis://localhost:6379/0
SECRET_KEY=your-secret-key-for-jwt
```

---

## ğŸ“Š APIæ–‡æ¡£

æœåŠ¡å™¨å¯åŠ¨åï¼Œè®¿é—®ï¼š

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

### ä¸»è¦APIç«¯ç‚¹

```
POST   /api/v1/auth/login           # å®¢æˆ·ç«¯ç™»å½•
POST   /api/v1/messages              # ä¸ŠæŠ¥æ¶ˆæ¯
GET    /api/v1/messages/{id}/reply  # è·å–å›å¤
POST   /api/v1/heartbeat             # å‘é€å¿ƒè·³
GET    /api/v1/stats                 # è·å–ç»Ÿè®¡
```

---

## ğŸ”§ å¼€å‘æŒ‡å—

### å®¢æˆ·ç«¯å¼€å‘

å®¢æˆ·ç«¯åªåšUIè‡ªåŠ¨åŒ–å’Œé€šä¿¡ï¼Œä¸åšä¸šåŠ¡é€»è¾‘ï¼š

```python
# client/agent/wx_automation.py
class WxAutomation:
    def get_new_messages(self):
        """è·å–å¾®ä¿¡æ–°æ¶ˆæ¯"""
        # åªè´Ÿè´£æŠ“å–ï¼Œä¸å¤„ç†ä¸šåŠ¡
        pass
    
    def send_message(self, chat_id, content):
        """å‘é€æ¶ˆæ¯"""
        # åªè´Ÿè´£å‘é€
        pass
```

### æœåŠ¡å™¨å¼€å‘

æœåŠ¡å™¨å¤„ç†æ‰€æœ‰å¤æ‚ä¸šåŠ¡ï¼š

```python
# server/services/message_service.py
class MessageService:
    async def process_message(self, agent_id, message):
        """å¤„ç†æ¶ˆæ¯ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘"""
        # 1. å»é‡
        # 2. å®¢æˆ·è¯†åˆ«
        # 3. è§„åˆ™åˆ¤æ–­
        # 4. çŸ¥è¯†åº“æ£€ç´¢
        # 5. AIç”Ÿæˆ
        # 6. ä¿å­˜æ•°æ®åº“
        pass
```

---

## ğŸ¯ éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ

```
1ä¸ªå¼€å‘æœº:
- æœ¬åœ°è¿è¡ŒæœåŠ¡å™¨ï¼ˆlocalhost:8000ï¼‰
- æœ¬åœ°è¿è¡Œå®¢æˆ·ç«¯
- ä½¿ç”¨SQLiteæ•°æ®åº“
```

### æµ‹è¯•ç¯å¢ƒ

```
1å°äº‘æœåŠ¡å™¨ï¼ˆ2C4Gï¼‰:
- Docker Composeéƒ¨ç½²
- PostgreSQL + Redis
- 1-3ä¸ªå®¢æˆ·ç«¯
```

### ç”Ÿäº§ç¯å¢ƒ

```
äº‘æœåŠ¡å™¨é›†ç¾¤:
- 2å°åº”ç”¨æœåŠ¡å™¨ï¼ˆ4C8Gï¼‰+ è´Ÿè½½å‡è¡¡
- 1å°æ•°æ®åº“æœåŠ¡å™¨ï¼ˆ4C16Gï¼‰PostgreSQLä¸»ä»
- Rediså“¨å…µé›†ç¾¤
- 10+ Windowså®¢æˆ·ç«¯
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | å•ä½“æ¶æ„ | C/Sæ¶æ„ | æ”¹è¿› |
|------|---------|---------|------|
| å®¢æˆ·ç«¯å†…å­˜ | ~2GB | ~50MB | â†“97% |
| å®¢æˆ·ç«¯CPU | 20-40% | <5% | â†“85% |
| éƒ¨ç½²æˆæœ¬ | é«˜ | ä½ | â†“60% |
| æ‰©å±•æ€§ | å·® | ä¼˜ç§€ | âœ… |
| å‡çº§éš¾åº¦ | é«˜ | ä½ | âœ… |

---

## ğŸ” æ•…éšœæ’æŸ¥

### å®¢æˆ·ç«¯æ— æ³•è¿æ¥æœåŠ¡å™¨

1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ï¼š
   ```bash
   curl http://localhost:8000/api/v1/health
   ```

2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

3. æŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—ï¼š`logs/client.log`

### æœåŠ¡å™¨å“åº”æ…¢

1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
2. æŸ¥çœ‹Redisç¼“å­˜
3. æ£€æŸ¥AIç½‘å…³é…ç½®
4. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼š`logs/server.log`

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… åŸºç¡€æ¶æ„å·²æ­å»º
2. â­ï¸ å®Œå–„ä¸šåŠ¡é€»è¾‘ï¼ˆAIã€çŸ¥è¯†åº“ã€ERPï¼‰
3. â­ï¸ æ·»åŠ WebSocketæ”¯æŒï¼ˆå®æ—¶é€šä¿¡ï¼‰
4. â­ï¸ å®Œå–„ç›‘æ§å’Œå‘Šè­¦
5. â­ï¸ æ€§èƒ½ä¼˜åŒ–å’Œå‹åŠ›æµ‹è¯•

---

**ğŸ‰ C/Sæ¶æ„é‡æ„å®Œæˆï¼ç°åœ¨å¯ä»¥å¼€å§‹å¼€å‘å’Œéƒ¨ç½²äº†ï¼**

